<!doctype html>
<html>
    <head>
        <title>Glitchy 3 bit dither</title>
        <style>
            * {                 -moz-box-sizing: border-box;
                box-sizing: border-box;
            }
            body {
                font-family: san-serif;
                font-size: 12px;
            }
            #output { width:100%; }
            #output img {display:inline;width:33%;border:1px solid #AAA;}
            #output h2 {display:none}
        </style>
    </head>
    <body>
        <h1>Glitchy 3 Bit Dither:Glitch Chooser</h1>
        <div style="width:600px;">
            <p>Original Implemented by Nolan Caudill, code on github <a href="https://github.com/mncaudill/3bitdither">here</a></p>
            <p>"Enhanced" by JKirchartz, code also on github <a href="https://github.com/jkirchartz/Glitchy3bitdither">here</a></p>
            <p>This runs completely client-side, using the FileReader and canvas APIs, your image isn't being uploaded to any server. If you have a decent browser, this could work. Also, you can right-click and save the result of the processing.</p>
            <p>Check out some curated images at <a href="http://glitches.jkirchartz.com/">glitches.jkirchartz.com</a></p>
            <p>This is the glitch cruiser version, you might want to see the <a href="index.html">demo version</a>, the <a href="glitch.html">glitch only version</a>, or the <a href="GlitchCruiser.html">Glitch Cruiser</a>.</p>
        </div>
        <h2>instructions</h2>
        <p>Select an image, then a mutation. Each time you hit the button the function is run on the result of the last time.</p>
        <div id="form">
            <input type="file" id="uploader">
        </div>
        <div id="output"></div>
        <br>
        <script src="GlitchyDither.js" type="text/javascript"></script>
        <script src="http://code.jquery.com/jquery-1.9.1.min.js" type="text/javascript"></script>
        <script>
            var exp = [original, dither8Bit, ditherHalftone, ditherAtkinsons, ditherFloydSteinberg, ditherBayer, ditherBayer3, ditherRandom, ditherRandom2, colorShift, greenShift, redShift, blueShift, sslice, sslice2, sslice3, AnySort, AnyShortSort, slice, slice2, slice3, ditherBitshift, focusImage, superShift, superSlice2, superSlice, fractalGhosts, fractalGhosts2, shortsort, shortbettersort, shortdumbsort, sort, bettersort, dumbsort, invert, rgb_glitch, DrumrollVertical, DrumrollHorizontal, DrumrollVerticalWave, DrumrollHorizontalWave],
            picker = document.createElement("select"),
            form = document.getElementById("form"),
            functions = exp.sort(),
            img, orig;

            /* populate picker */
            for(var i=0, l = functions.length;i<l;i++){
                var opt = document.createElement("option");
                opt.value = functions[i].name;
                opt.innerHTML = functions[i].name;
                picker.appendChild(opt);
            }
            form.appendChild(picker);
            function place(replace){
                var tmp = document.getElementsByTagName("img");
                if(replace){document.getElementById("output").removeChild(tmp[0]);}
                generate(tmp[0],picker.value);
            }
            var apply = document.createElement("button");
            apply.innerHTML = "apply mutation";
            form.appendChild(apply);
            apply.onclick = function(){place(false);};
            var replace = document.createElement("button");
            replace.innerHTML = "replace mutation";
            form.appendChild(replace);
            replace.onclick = function(){place(true);};

            function handleFileSelect(e) {
                var file = e.target.files[0];
                // Only process image files.
                if (!file.type.match('image.*')) {
                    return;
                }
                var reader = new FileReader();
                // Closure to capture the file information.
                reader.onload = function(e) {
                    img = document.createElement("img");
                    img.onload = function() {
                        orig = img;
                        generate(img,"original");
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                document.getElementById("output").innerHTML = "";
            }

            function getfunbyname(name){
                var funs = functions;
                for(var i = 0, l = funs.length;i<l;i++){
                    if(funs[i].name === name){
                        return funs[i];
                    }
                }
            }
            function generate(img,chosen){
                /* setup */
                var width = img.width;
                var height = img.height;
                var canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                var ctx = canvas.getContext('2d');
                /* execute */
                if(chosen === "original"){
                    ctx.drawImage(orig,0,0);
                    drawDitherResult2(canvas,original,chosen);
                }else{
                    ctx.drawImage(img,0,0);
                    drawDitherResult2(canvas,getfunbyname(chosen),chosen);
                }
            }

            document.getElementById('uploader').addEventListener('change', handleFileSelect, false);
        </script>
    </body>
</html>
