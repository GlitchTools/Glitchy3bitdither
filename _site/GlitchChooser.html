<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Glitchy3bitDither</title>
    <link media="all" rel="stylesheet" href="/Glitchy3bitdither/style.css" type="text/css" />
    <script src="/Glitchy3bitdither/GlitchyDither.js" type="text/javascript"></script>
</head>
<body>
    <header>
        <h1>Glitchy3bitDither</h1>
        <nav>
            <a href="/Glitchy3bitdither/index.html">Demo</a>
            <a href="/Glitchy3bitdither/glitch.html">Glitch Only</a>
            <a href="/Glitchy3bitdither/GlitchCruiser.html">Glitch Cruiser</a>
            <a href="/Glitchy3bitdither/GlitchChooser.html">Glitch Chooser</a>
        </nav>
        <a href="#" id="info_btn">i</a>
    </header>
    <div id="info">
        <div>
            <p>Original Implemented by Nolan Caudill, code on github <a href="https://github.com/mncaudill/3bitdither">here</a></p>
            <p>"Enhanced" by JKirchartz, code also on github <a href="https://github.com/jkirchartz/Glitchy3bitdither">here</a></p>
            <p>This runs completely client-side, using the FileReader and canvas APIs, your image isn't being uploaded to any server. If you have a decent browser, this should work. Also, you can right-click and save the result of the processing.</p>
            <p>Check out some curated images at <a href="http://glitches.jkirchartz.com/">glitches.jkirchartz.com</a></p>
            <a href="#" id="close_btn">Ã—</a>
        </div>
    </div>
    <main>
    <h1>Glitch Chooser</h1>
<h2>instructions</h2>
<p>Select an image, then apply a mutation. Each time you apply a mutation a new image is created from the input. Each time you replace a mutation the new image is replaced.</p>
<div id="form">
    <input type="file" id="uploader">
    <button id="apply">apply</button>
    <button id="replace">replace</button>
</div>
<div id="output"></div>
<script>
    var exp = [original, dither8Bit, ditherHalftone, ditherAtkinsons, ditherFloydSteinberg, ditherBayer, ditherBayer3, ditherRandom, ditherRandom2, colorShift, greenShift, redShift, blueShift, sslice, sslice2, sslice3, AnySort, AnyShortSort, slice, slice2, slice3, ditherBitshift, focusImage, superShift, superSlice2, superSlice, fractalGhosts, fractalGhosts2, shortsort, shortbettersort, shortdumbsort, sort, bettersort, dumbsort, invert, rgb_glitch, DrumrollVertical, DrumrollHorizontal, DrumrollVerticalWave, DrumrollHorizontalWave],
    picker = document.createElement("select"),
    form = document.getElementById("form"),
    functions = exp.sort(),
    img, orig;

    /* populate picker */
    for(var i=0, l = functions.length;i<l;i++){
        var opt = document.createElement("option");
        opt.value = functions[i].name;
        opt.innerHTML = functions[i].name;
        picker.appendChild(opt);
    }
    form.appendChild(picker);
    function place(replace){
        var tmp = document.getElementsByTagName("img");
        if(replace){document.getElementById("output").removeChild(tmp[0]);}
        generate(tmp[0],picker.value);
    }
    var apply = document.getElementById('apply');
    var replace = document.getElementById('replace');
    apply.onclick = function(){place(false);};
    replace.onclick = function(){place(true);};

    function handleFileSelect(e) {
        var file = e.target.files[0];
        // Only process image files.
        if (!file.type.match('image.*')) {
            return;
        }
        var reader = new FileReader();
        // Closure to capture the file information.
        reader.onload = function(e) {
            img = document.createElement("img");
            img.onload = function() {
                orig = img;
                generate(img,"original");
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
        document.getElementById("output").innerHTML = "";
    }

    function getfunbyname(name){
        var funs = functions;
        for(var i = 0, l = funs.length;i<l;i++){
            if(funs[i].name === name){
                return funs[i];
            }
        }
    }
    function generate(img,chosen){
        /* setup */
        var width = img.width;
        var height = img.height;
        var canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        var ctx = canvas.getContext('2d');
        /* execute */
        if(chosen === "original"){
            ctx.drawImage(orig,0,0);
            drawDitherResult2(canvas,original,chosen);
        }else{
            ctx.drawImage(img,0,0);
            drawDitherResult2(canvas,getfunbyname(chosen),chosen);
        }
    }

    document.getElementById('uploader').addEventListener('change', handleFileSelect, false);
</script>

    </main>
    <script>
        window.onload = function(){
            // handle the modal window (the rest is just CSS, woot!)
            var info = document.getElementById('info'),
                info_btn = document.getElementById('info_btn'),
                close_btn = document.getElementById('close_btn');
            function modal(e) {
                e.preventDefault;
                // toggle
                if(info.style.display === "block"){
                    info.style.display = "none";
                }else{
                    info.style.display = "block";
                }
                return false;
            }
            info_btn.onclick = modal;
            close_btn.onclick = modal;
            // set current page hilight for nav
            // depends on having a file extension
            document.body.id = location.pathname.slice(location.pathname.lastIndexOf('/')+1,location.pathname.lastIndexOf('.'));
        }
    </script>
</body>
</html>
