<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Glitchy3bitDither</title>
    <link media="all" rel="stylesheet" href="/Glitchy3bitdither/style.css" type="text/css" />
    <script src="/Glitchy3bitdither/GlitchyDither.js" type="text/javascript"></script>
</head>
<body>
    <header>
        <h1>Glitchy3bitDither</h1>
        <nav>
            <a href="/Glitchy3bitdither/index.html">Demo</a>
            <a href="/Glitchy3bitdither/glitch.html">Glitch Only</a>
            <a href="/Glitchy3bitdither/GlitchCruiser.html">Glitch Cruiser</a>
            <a href="/Glitchy3bitdither/GlitchChooser.html">Glitch Chooser</a>
        </nav>
        <a href="#" id="info_btn">i</a>
    </header>
    <div id="info">
        <div>
            <p>Original Implemented by Nolan Caudill, code on github <a href="https://github.com/mncaudill/3bitdither">here</a></p>
            <p>"Enhanced" by JKirchartz, code also on github <a href="https://github.com/jkirchartz/Glitchy3bitdither">here</a></p>
            <p>This runs completely client-side, using the FileReader and canvas APIs, your image isn't being uploaded to any server. If you have a decent browser, this should work. Also, you can right-click and save the result of the processing.</p>
            <p>Check out some curated images at <a href="http://glitches.jkirchartz.com/">glitches.jkirchartz.com</a></p>
            <a href="#" id="close_btn">Ã—</a>
        </div>
    </div>
    <main>
    <div id="form">
    <input type="file" id="uploader"/>
    <label>Enable experimental functions? <input type="checkbox" id="experimental" /></label>
</div>
<div id="output"></div>
<script>
    function handleFileSelect(e) {
        var file = e.target.files[0];
        // Only process image files.
        if (!file.type.match('image.*')) {
            return;
        }
        var reader = new FileReader();
        // Closure to capture the file information.
        reader.onload = function(e) {
            var img = document.createElement("img");
            img.onload = function() {
                var width = img.width;
                var height = img.height;
                var canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                var ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                drawDitherResult(canvas, function(i) {
                    return i;
                }, 'original');
                var exp = [sslice, sslice2, sslice3,AnySort,AnyShortSort,rgb_glitch,invert,shortsort,shortbettersort,shortdumbsort,sort,bettersort,dumbsort,fractalGhosts,fractalGhosts2,DrumrollHorizontal,DrumrollVertical],
                    orig = [focusImage, slice, slice2, slice3, ditherBitshift, colorShift, ditherRandom, ditherRandom2, ditherBayer, ditherBayer3, redShift, greenShift, blueShift, superShift, superSlice, superSlice2, ditherAtkinsons, ditherFloydSteinberg, ditherHalftone, dither8Bit],
                    functions = document.getElementById("experimental").checked ? orig.concat(exp) : orig;
                for(var i = 0;i<functions.length;i++){
                    console.log(i,functions[i]);
                    ctx.drawImage(img, 0, 0);
                    drawDitherResult(canvas,functions[i],functions[i].name);
                }
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
        document.getElementById("output").innerHTML = "";
    }
    document.getElementById('uploader').addEventListener('change', handleFileSelect, false);
</script>

    </main>
    <script>
        window.onload = function(){
            // handle the modal window (the rest is just CSS, woot!)
            var info = document.getElementById('info'),
                info_btn = document.getElementById('info_btn'),
                close_btn = document.getElementById('close_btn');
            function modal(e) {
                e.preventDefault;
                // toggle
                if(info.style.display === "block"){
                    info.style.display = "none";
                }else{
                    info.style.display = "block";
                }
                return false;
            }
            info_btn.onclick = modal;
            close_btn.onclick = modal;
            // set current page hilight for nav
            // depends on having a file extension
            document.body.id = location.pathname.slice(location.pathname.lastIndexOf('/')+1,location.pathname.lastIndexOf('.'));
        }
    </script>
</body>
</html>
