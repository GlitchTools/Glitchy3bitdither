<!doctype html>
<html>
    <head>
        <title>Glitchy 3 bit dither</title>
        <style>
            body {
                font-family: san-serif;
                font-size: 12px;
            }
            img, canvas { display:inline;}
        </style>
    </head>
     <body>
        <h1>Glitchy 3 Bit Dither</h1>
        <div style="width:600px;">
            <p>Original Implemented by Nolan Caudill, code on github <a href="https://github.com/mncaudill/3bitdither">here</a></p>
            <p>"Enhanced" by JKirchartz, code also on github <a href="https://github.com/jkirchartz/Glitchy3bitdither">here</a></p>
            <p>This runs completely client-side, using the FileReader and canvas APIs, your image isn't being uploaded to any server. If you have a decent browser, this could work. Also, you can right-click and save the result of the processing.</p>
            <p>Check out some curated images at <a href="http://glitches.jkirchartz.com/">glitches.jkirchartz.com</a></p>
            <p>You can also try the <a href="glitch.html">glitch-only script</a></p>
        </div>

        <input type="file" id="uploader">
        <div id="output"></div>
        <br>
        <script src="GlitchyDither.js" type="text/javascript"></script>
        <script>
            function handleFileSelect(e) {
                var file = e.target.files[0];
                // Only process image files.
                if (!file.type.match('image.*')) {
                    return;
                }
                var reader = new FileReader();
                // Closure to capture the file information.
                reader.onload = function(e) {
                    var img = new Image();
                    img.onload = function() {
                        var width = img.width;
                        var height = img.height;
                        var canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        var ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, function(i) {
                            return i;
                        }, 'original');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, slice, 'Slice');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, slice2, 'Slice 2');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, slice3, 'Slice 3');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, superSlice, 'Super Slice');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, superSlice2, 'Super Slice 2');
                        ctx.drawImage(img, 0, 0); // Reset
                        drawDitherResult(canvas, ditherAtkinsons, 'Atkinson\'s');
                        ctx.drawImage(img, 0, 0); // Reset
                        drawDitherResult(canvas, ditherFloydSteinberg, 'Floyd-Steinberg');
                        ctx.drawImage(img, 0, 0); // Reset
                        drawDitherResult(canvas, ditherHalftone, 'Halftone');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, ditherBayer, 'Bayer (ordered) - 1 bit');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, dither8Bit, 'Google Maps 8-Bit');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, ditherBayer, 'Bayer (ordered) - 1 bit');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, ditherBayer3, 'Bayer (ordered) - 3 bit');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, ditherRandom, 'Random');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, ditherRandom2, 'Random2');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, ditherBitshift, 'Bitshift');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, colorShift, 'Color Shift');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, redShift, 'Red Shift');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, greenShift, 'Green Shift');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, blueShift, 'Blue Shift');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, focusImage, 'Pixelate');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, superShift, 'Super Shift');
                        //this one seems to be causing problems...
                        //ctx.drawImage(img, 0, 0);
                        //drawDitherResult(canvas, theWorks, 'The Works');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, randomGlitch, 'randomGlitch');
                        ctx.drawImage(img, 0, 0);
                        drawDitherResult(canvas, glitch, 'Glitch');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                document.getElementById("output").innerHTML = "";
            }
            document.getElementById('uploader').addEventListener('change', handleFileSelect, false);
        </script>
    </body>
</html>
